# Danozord
## Solution for team tour of PROD'25 finals

# Репозитории
- Бэкенд: https://REDACTED/team-43/backend
- Фронтенд: https://REDACTED/team-43/frontend

# Креды

Вход в панель администратора: https://prod-team-43-3q0k70f5.REDACTED/admin/
Вход в панель организатора и участника: https://prod-team-43-3q0k70f5.REDACTED/login

1. Администратор + организатор: log `danozord`, pass `olesyamaystrenko`, token `REDACTED.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQxMTQ5NDE1LCJpYXQiOjE3NDEwNjMwMTUsImp0aSI6ImY2NmU0MWJjMGU3ODRmNWY5NDUwMjk4ZTJjYjc0YmExIiwidXNlcl9pZCI6ImUwYTMwYTk4LTIwMTctNDY1NS04N2Y2LTVjZjM1ODhmMGNhNiJ9.S_TMAVtU4HRSTmTzZd8T6vA4u-o9l6b7VueVMWYEA3A`
2. Организатор: log `org`, pass `olesya31`, token `REDACTED.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQxMTUwMTE1LCJpYXQiOjE3NDEwNjM3MTUsImp0aSI6IjRmOGRlYTU5ZTg3ZjRlYWI5MzYxM2EyNzk3MThjYzdjIiwidXNlcl9pZCI6ImM0MGViYzQ3LTA5OTQtNGI4My1iNjJiLWMzYzc3NDZhZDEwYyJ9.M1w8RmzdYqDB12C6f5sS53gxvuCR0QaJ4DatQhc7E3I`
3. Организатор: log `cofya`, pass `testPass123`, token `REDACTED.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQxMTUwMDk0LCJpYXQiOjE3NDEwNjM2OTQsImp0aSI6ImVhNDliODI3OTUzODRlNDNiZWFhNjhhMTI4ZDg1ODM5IiwidXNlcl9pZCI6ImFlODZlN2Q4LWIwMzUtNDZkZi1hNWZlLWIzZTRiNWEyNmEzMCJ9.XC3nyUEMvdohMyXZdl1h5QxgDib_IUvtpjfJhElQKPc`
4. Организатор: log `org42`, pass `olesya42`, token `REDACTED.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQxMTUwMDcxLCJpYXQiOjE3NDEwNjM2NzEsImp0aSI6IjYyNTA2MTdiZWMzYjQ0ZTU4ZGMyMTIxMWRkNmEyNTJmIiwidXNlcl9pZCI6IjFkZGMzYWU2LTNmOTMtNDIwNi05MTQ2LWY0ZTYwMWY2MzRlYSJ9.qBKybntpIwCsYWNb4Y3SSw1kiOJJMJN6bXE94CCaSAQ`
5. Участник: log `user5`, pass `user5`, token `REDACTED.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQxMTUwMDUzLCJpYXQiOjE3NDEwNjM2NTMsImp0aSI6ImFlNzYxYjg1NTY2ZDRmNzJiZjI1NmQ4MmRjZWVjYzFkIiwidXNlcl9pZCI6Ijc1Y2RjYjFhLTYxM2UtNGY1NS1iNjFmLTBiMmY0NzAxYWYyMSJ9.6S5gXmYHNBOC3AEB4fqHFq6xNNhQJvgc2U-HdLqDFNE`
6. Участник: log `user6`, pass `user6`, token `REDACTED.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQxMTUwMDMwLCJpYXQiOjE3NDEwNjM2MzAsImp0aSI6IjNmZjU4M2IwMjJhYTQzOTRiNThlZDdjMjBkNThjOWE3IiwidXNlcl9pZCI6ImZlNGU0OWU5LWFlZDQtNDhlOC1iYWEwLWQ0NzJjOTRkOTE5YyJ9.HGsfVl1ZML_FJXqN2SpIn2L1Wyq2_WTGo4OvS-b8hHY`
7. Участник: log `user7`, pass `user7`, token `REDACTED.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQxMTUwMDExLCJpYXQiOjE3NDEwNjM2MTEsImp0aSI6IjcwNzQ1NjE3YjU0NjRmNDZhYmJkOTI5ZjlkM2Q4NDg2IiwidXNlcl9pZCI6IjQ3MzlhOTM0LTM5MWEtNDBjZi05NjQzLTU0M2NjMjQ2OTcwOCJ9.PSpCNPFJE5uCVcvJ2PNx49b52FU9GGbMcdXzzcPpNWU`
8. Участник: log `user8`, pass `user8`, token `REDACTED.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQxMTQ5OTkwLCJpYXQiOjE3NDEwNjM1OTAsImp0aSI6IjUxN2E1Nzk5NWMwNTQwNWY5MTYwNjg4MTQ5M2MwM2MzIiwidXNlcl9pZCI6IjcxNjQzOGIxLTE3NjgtNDJjNy05Zjc5LWZkZTI2ZjM2ZmJhNCJ9.5majdDGXM2GDBEucWje7Trz6mp9vl6C2M2eGHAlFtw4`
9. Участник: log `user9`, pass `user9`, token `REDACTED.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQxMTQ5OTc0LCJpYXQiOjE3NDEwNjM1NzQsImp0aSI6ImYxYTMxMWFiZTNiYTRkNTBiYzk2Njg3ZTBmMmU4MzA1IiwidXNlcl9pZCI6ImM3ZTk0ODdkLWJmODktNDRkZi1iN2RiLWU0YjRjZDY0OWNlNiJ9.sX1eNfUQbnWQ8ckAcQ5RUZYRbPhli8y6kaMAaq7Cl7g`
10. Участник: log `user10`, pass `user10`, token `REDACTED.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQxMTQ5OTU1LCJpYXQiOjE3NDEwNjM1NTUsImp0aSI6ImQwYjA4MTk3NzMxYjQ4MzdiNGQzMmY0MjgwOGVkYWFlIiwidXNlcl9pZCI6IjI5OGMxYzFjLTJkMzItNGY3Mi04MTZhLWY4YWE2ODNlNDFkMCJ9.auLcYTCi2fAApmdxztSigpRbe10Y72EwWZ1-p4MHomA`.

# Архитектура бэкенда

В docker-compose есть 4 контейнера: nginx, postgres, backend, frontend.

Клиент отправляет запросы на nginx. nginx перенаправляет запрос либо в backend (по определённым путям),
либо в frontend. Backend обрабатывает запрос, обращаясь к postgres, и возвращает ответ.

В проекте используется фреймворк Django и Django Rest Framework.
Django обеспечивает быструю разработку и легкость в поддержке, в то время как DRF добавляет гибкость для эффективной разработки API.
PostgreSQL поддерживает репликацию и шардирование, что позволяет эффективно работать с большими объемами данных.
Этот стек легко масштабируется как вертикально, так и горизонтально, обеспечивая стабильную работу при росте трафика и данных.
Весь бэкенд построен по архитектуре MVC.
Кроме того, автоматические чекеры реализованы с использованием абстракций, что позволяет в дальнейшем легко расширять кодовую базу.
Диаграммы C4:

![c4_1.png](docs/c4_1.png)
![c4_2.png](docs/c4_2.png)
![c4_3.png](docs/c4_3.png)

# Тесты

Unit-тесты лежат в папке tests/unit. Они покрывают бизнес-логику - чекер решений, который отделён от бэкенда.

Интеграционные тесты лежат в папке tests/e2e и запускаются при помощи Tavern. Они покрывают большинство пользовательских
сценариев.

Мы приняли решение не снимать coverage, поскольку он не будет давать релевантные результаты ввиду декларативного подхода
Django и DRF к написанию бэкенда - даже без написания тестов coverage будет около 50-70%.

# Pipeline

Код пайплайна доступен в файле [.gitlab-ci.yml](.gitlab-ci.yml).

Сначала идёт сборка проекта - образ бэкенда пушится в registry. Затем запускаются unit- и e2e-тесты,
таким образом мы гарантируем, что на прод попадает всегда рабочая версия. После чего запускается деплой, где происходит
подключение к серверу.

Аналогичным образом сделан CI в репозитории фронтенда, но там есть только деплой.

# Схема БД

Доступна в файле [docs/postgres-db.svg](docs/postgres-db.svg).

# Фронтенд

Доступен по адресу https://prod-team-43-3q0k70f5.REDACTED.

Созздание организаторов

![01_create_orgs.gif](docs/01_create_orgs.gif)

Управление контестами

![02_contests_crud.gif](docs/02_contests_crud.gif)

Управление задачами внутри контестов

![03_tasks_crud.gif](docs/03_tasks_crud.gif)

Форматирование через markdown

![04_markdown.gif](docs/04_markdown.gif)

Загрузка файлов

![05_files.gif](docs/05_files.gif)

Командное участие

![06_teamed.gif](docs/06_teamed.gif)

Отправка решений

![07_submissions.gif](docs/07_submissions.gif)

Автоматическая проверка

![08_autocheck.gif](docs/08_autocheck.gif)

Кросс-проверки решений

![09_crosscheck.gif](docs/09_crosscheck.gif)

Статистика в профиле

![10_stats.png](docs/10_stats.png)